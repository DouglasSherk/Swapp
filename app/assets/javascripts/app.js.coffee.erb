<% environment.context_class.instance_eval { include AngularRoutingHelper } %>

window.App = angular.module('Swapp', ['ngResource', 'ngRoute'])

App.config ['$routeProvider', ($routeProvider) ->
  <% getAllAngularRoutes().each do |route| %>
  $routeProvider.when '<%= angularRouteAppPath(route).sub '#', '' %>',
    templateUrl: '<%= angularRouteFilePath(route) %>',
    reloadOnSearch: false,
  <% end %>
  $routeProvider.otherwise
    templateUrl: '<%= angularRouteFilePath(templates_path) %>',
    reloadOnSearch: false,
]

App.run ['$rootScope', '$location', \
         ($rootScope, $location) ->
  $rootScope.menuItems = [
    {name: 'Pickups', link: '/pickups'},
    {name: 'What goes where?', link: '/search'},
    {name: 'FAQ', link: '/faq'},
    {name: 'Contact', link: '/contact'},
    {name: 'Settings', link: '/settings'}
  ]

  $rootScope.isActiveMenu = (path) ->
    return $location.path().indexOf(path) == 0 ||
           path == '/pickups' && $location.path().length <= 1
]
